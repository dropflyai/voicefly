-- Clean up ALL test accounts and businesses to start fresh
-- This removes orphaned accounts and duplicate test data

-- Step 1: Delete test business_users associations
DELETE FROM business_users
WHERE business_id IN (
  SELECT id FROM businesses WHERE email LIKE 'test.%@gmail.com'
);

-- Step 2: Delete test businesses
DELETE FROM businesses
WHERE email LIKE 'test.%@gmail.com';

-- Step 3: Delete test auth users
DELETE FROM auth.users
WHERE email LIKE 'test.%@gmail.com';

-- Step 4: Verify cleanup
SELECT
  (SELECT COUNT(*) FROM auth.users WHERE email LIKE 'test.%@gmail.com') as auth_users,
  (SELECT COUNT(*) FROM businesses WHERE email LIKE 'test.%@gmail.com') as businesses,
  (SELECT COUNT(*) FROM business_users WHERE business_id IN (SELECT id FROM businesses WHERE email LIKE 'test.%@gmail.com')) as business_users;
